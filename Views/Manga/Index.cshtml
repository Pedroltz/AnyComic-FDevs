@model IEnumerable<AnyComic.Models.Manga>

@{
    ViewData["Title"] = "Manga Catalog - AnyComic";
}

<!-- Manga Catalog Page - HotComics Style -->
<div class="page-container">
    <!-- Page Header -->
    <div class="page-header">
        <h1 class="page-title">Manga Catalog</h1>
        <p class="page-subtitle">Browse and discover amazing manga</p>
    </div>

    <!-- Search and Filter Section -->
    <div class="card mb-4" style="background-color: var(--bg-light); border: 1px solid var(--border-color);">
        <div class="card-body">
            <form method="get" asp-controller="Manga" asp-action="Index" id="searchForm">
                <div class="row g-3">
                    <!-- Search by Title -->
                    <div class="col-md-4">
                        <label for="searchTerm" class="form-label" style="font-weight: 600; color: var(--text-primary);">Search by Title</label>
                        <input type="text" class="form-control" id="searchTerm" name="searchTerm" value="@ViewBag.SearchTerm" placeholder="Enter manga title..." style="background-color: var(--bg-primary); color: var(--text-primary); border-color: var(--border-color);">
                    </div>

                    <!-- Search by Author -->
                    <div class="col-md-4">
                        <label for="autor" class="form-label" style="font-weight: 600; color: var(--text-primary);">Search by Author</label>
                        <input type="text" class="form-control" id="autor" name="autor" value="@ViewBag.Autor" placeholder="Enter author name..." style="background-color: var(--bg-primary); color: var(--text-primary); border-color: var(--border-color);">
                    </div>

                    <!-- Sort By -->
                    <div class="col-md-4">
                        <label class="form-label" style="font-weight: 600; color: var(--text-primary);">Sort By</label>
                        <input type="hidden" id="sortBy" name="sortBy" value="@(ViewBag.SortBy ?? "data_desc")">
                        <div class="dropdown w-100">
                            <button class="btn dropdown-toggle w-100 text-start d-flex justify-content-between align-items-center" type="button" id="sortByDropdown" data-bs-toggle="dropdown" aria-expanded="false" style="background-color: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color);">
                                <span id="sortByLabel">
                                    @{
                                        var sortByText = ViewBag.SortBy switch
                                        {
                                            "data_asc" => "Oldest First",
                                            "titulo_asc" => "Title (A-Z)",
                                            "titulo_desc" => "Title (Z-A)",
                                            "autor_asc" => "Author (A-Z)",
                                            "autor_desc" => "Author (Z-A)",
                                            _ => "Newest First"
                                        };
                                    }
                                    @sortByText
                                </span>
                            </button>
                            <ul class="dropdown-menu w-100" aria-labelledby="sortByDropdown" style="background-color: var(--bg-secondary); border: 1px solid var(--border-color);">
                                <li><a class="dropdown-item sort-option" href="#" data-value="data_desc" data-label="Newest First">Newest First</a></li>
                                <li><a class="dropdown-item sort-option" href="#" data-value="data_asc" data-label="Oldest First">Oldest First</a></li>
                                <li><a class="dropdown-item sort-option" href="#" data-value="titulo_asc" data-label="Title (A-Z)">Title (A-Z)</a></li>
                                <li><a class="dropdown-item sort-option" href="#" data-value="titulo_desc" data-label="Title (Z-A)">Title (Z-A)</a></li>
                                <li><a class="dropdown-item sort-option" href="#" data-value="autor_asc" data-label="Author (A-Z)">Author (A-Z)</a></li>
                                <li><a class="dropdown-item sort-option" href="#" data-value="autor_desc" data-label="Author (Z-A)">Author (Z-A)</a></li>
                            </ul>
                        </div>
                    </div>

                    <!-- Date Range Start -->
                    <div class="col-md-6">
                        <label for="dataInicio" class="form-label" style="font-weight: 600; color: var(--text-primary);">Release Date From</label>
                        <input type="date" class="form-control" id="dataInicio" name="dataInicio" value="@ViewBag.DataInicio" style="background-color: var(--bg-primary); color: var(--text-primary); border-color: var(--border-color);">
                    </div>

                    <!-- Date Range End -->
                    <div class="col-md-6">
                        <label for="dataFim" class="form-label" style="font-weight: 600; color: var(--text-primary);">Release Date To</label>
                        <input type="date" class="form-control" id="dataFim" name="dataFim" value="@ViewBag.DataFim" style="background-color: var(--bg-primary); color: var(--text-primary); border-color: var(--border-color);">
                    </div>
                </div>

                <!-- Buttons -->
                <div class="d-flex gap-2 mt-3">
                    <button type="submit" class="btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="vertical-align: text-bottom; margin-right: 4px;">
                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                        </svg>
                        Search
                    </button>
                    <a asp-controller="Manga" asp-action="Index" class="btn btn-outline-secondary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="vertical-align: text-bottom; margin-right: 4px;">
                            <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                            <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                        </svg>
                        Clear Filters
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Results Count -->
    @if (Model != null && Model.Any())
    {
        <div class="mb-3" style="color: var(--text-secondary); font-size: 14px;">
            <strong>@Model.Count()</strong> manga(s) found
        </div>
    }

    @if (Model != null && Model.Any())
    {
        <!-- Manga Grid - HotComics Style -->
        <div class="manga-grid fade-in">
            @foreach (var manga in Model)
            {
                <a asp-controller="Manga" asp-action="Details" asp-route-id="@manga.Id" style="text-decoration: none; color: inherit;">
                    <div class="manga-card">
                        <div class="manga-card-image">
                            @if (!string.IsNullOrEmpty(manga.ImagemCapa))
                            {
                                <img src="@manga.ImagemCapa" alt="@manga.Titulo" loading="lazy">
                            }
                            else
                            {
                                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #6c757d;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                                        <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                                    </svg>
                                    <p style="margin-top: 8px; font-size: 12px;">No cover</p>
                                </div>
                            }
                            <!-- Chapter Count Badge -->
                            @if (manga.Capitulos.Any())
                            {
                                <div style="position: absolute; top: 8px; right: 8px; background: rgba(0, 123, 255, 0.95); color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16" style="vertical-align: text-top; margin-right: 2px;">
                                        <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"/>
                                    </svg>
                                    @manga.Capitulos.Count Ch.
                                </div>
                            }
                        </div>
                        <div class="manga-card-body">
                            <h3 class="manga-card-title">@manga.Titulo</h3>
                            <p class="manga-card-author">@manga.Autor</p>
                            <div class="manga-card-info">
                                <span>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16" style="vertical-align: text-top; margin-right: 2px;">
                                        <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                                    </svg>
                                    @manga.DataCriacao.ToString("MMM dd, yyyy")
                                </span>
                            </div>
                        </div>
                    </div>
                </a>
            }
        </div>
    }
    else
    {
        <!-- Empty State -->
        <div class="alert alert-info text-center" style="margin-top: 40px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" viewBox="0 0 16 16" style="margin-bottom: 15px; opacity: 0.5;">
                <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"/>
            </svg>
            <h4 style="font-weight: 600; margin-bottom: 10px;">No manga found</h4>
            <p style="margin-bottom: 15px; color: #6c757d;">Try adjusting your search filters or browse all manga.</p>
            <a asp-controller="Manga" asp-action="Index" class="btn btn-primary">View All Manga</a>
        </div>
    }
</div>

<style>
    /* Fade-in animation for manga grid */
    .fade-in {
        animation: fadeIn 0.5s ease-in;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Form controls dark mode support */
    [data-theme="dark"] .form-control:focus,
    [data-theme="dark"] .form-select:focus {
        background-color: var(--bg-primary);
        color: var(--text-primary);
        border-color: #007bff;
    }

    /* Custom dropdown styling */
    .dropdown-menu {
        background-color: var(--bg-secondary) !important;
        border: 1px solid var(--border-color) !important;
    }

    .dropdown-item {
        color: var(--text-primary) !important;
        padding: 8px 16px;
        transition: background-color 0.2s ease;
    }

    .dropdown-item:hover,
    .dropdown-item:focus {
        background-color: rgba(128, 128, 128, 0.2) !important;
        color: var(--text-primary) !important;
    }

    [data-theme="dark"] .dropdown-menu {
        background-color: #1a1a1a !important;
        border: 1px solid #333 !important;
    }

    [data-theme="dark"] .dropdown-item {
        color: #ffffff !important;
        background-color: transparent;
    }

    [data-theme="dark"] .dropdown-item:hover,
    [data-theme="dark"] .dropdown-item:focus {
        background-color: rgba(128, 128, 128, 0.3) !important;
        color: #ffffff !important;
    }

    /* Light mode dropdown */
    [data-theme="light"] .dropdown-menu {
        background-color: #ffffff !important;
        border: 1px solid #dee2e6 !important;
    }

    [data-theme="light"] .dropdown-item {
        color: #212529 !important;
    }

    [data-theme="light"] .dropdown-item:hover,
    [data-theme="light"] .dropdown-item:focus {
        background-color: #f8f9fa !important;
        color: #212529 !important;
    }
</style>

<script>
    // Sort By Dropdown functionality
    document.addEventListener('DOMContentLoaded', function() {
        const sortOptions = document.querySelectorAll('.sort-option');
        const sortByInput = document.getElementById('sortBy');
        const sortByLabel = document.getElementById('sortByLabel');

        sortOptions.forEach(option => {
            option.addEventListener('click', function(e) {
                e.preventDefault();
                const value = this.getAttribute('data-value');
                const label = this.getAttribute('data-label');

                sortByInput.value = value;
                sortByLabel.textContent = label;
            });
        });
    });
</script>
